<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kingdom Rescue – Foster Portal</title>
  <style>
    /* —— Theme —— */
    :root{
      --bg:#0a0a0b;           /* page bg */
      --panel:#111214cc;      /* glass panel */
      --border:#ffffff1a;     /* subtle borders */
      --text:#f4f4f5;         /* primary text */
      --muted:#a1a1aa;        /* secondary text */
      --accent:#10b981;       /* emerald */
      --accent-2:#14b8a6;     /* teal */
      --shadow:0 10px 30px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    .hidden{display:none}
    .no-scrollbar{scrollbar-width:none}
    .no-scrollbar::-webkit-scrollbar{display:none}
    
    /* —— App Layout —— */
    .app{height:100dvh;width:100vw;display:flex;flex-direction:column;overflow:hidden}
    @media(min-width:768px){.app{flex-direction:row}}
    
    /* Sidebar (desktop) */
    .sidebar{display:none;width:288px;flex:0 0 288px;border-right:1px solid var(--border);background:color-mix(in oklab, #0b0c0d 80%, #0b0c0d 0%);backdrop-filter:saturate(120%) blur(8px)}
    @media(min-width:768px){.sidebar{display:flex;flex-direction:column}}

    /* Header */
    .header{padding:16px 16px 8px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.02),transparent)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--shadow)}
    .title{font-weight:700;letter-spacing:-.01em}
    .subtitle{color:var(--muted);font-size:12px;margin-top:2px}

    /* Search */
    .search{position:relative;padding:12px 16px}
    .search input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#121316c0;color:var(--text);outline:none}
    .search input:focus{box-shadow:0 0 0 3px color-mix(in oklab,var(--accent) 35%, transparent)}
    .search-list{position:absolute;left:16px;right:16px;top:56px;background:#0f1014f2;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);max-height:280px;overflow:auto;z-index:50}
    .search-item{display:block;width:100%;text-align:left;padding:10px 12px;border-radius:10px;background:transparent;border:0;color:var(--text)}
    .search-item:hover{background:rgba(255,255,255,.05)}
    .search-item small{display:block;color:var(--muted)}

    /* Thumbnail lists */
    .thumbs-vertical{flex:1;overflow:auto;padding:0 12px 12px}
    .thumbs-horizontal{display:flex;gap:8px;overflow:auto;padding:8px 8px}

    .thumb{display:flex;align-items:center;gap:10px;border:1px solid var(--border);background:#0f1012b3;border-radius:16px;padding:8px;transition:.18s ease;position:relative}
    /* Normalize button tiles so every thumbnail item is the same size */
    .thumb{
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
      width: 100%;
      height: 80px;        /* fixed tile height */
      overflow: hidden;    /* avoid text stretching the tile */
    }
    .thumb > div{
      display: flex;
      flex-direction: column;
      justify-content: center;  /* center text vertically */
      min-width: 0;             /* enable ellipsis */
    }
    .thumb:hover{background:#0f1012cc}
    .thumb.active{outline:3px solid color-mix(in oklab,var(--accent) 55%, transparent)}
    .thumb img{width:64px;height:64px;object-fit:cover;border-radius:12px}
    .thumb .name{font-weight:600;font-size:14px}
    .thumb .meta{color:var(--muted);font-size:12px}
    .badge{font-size:10px;color:#7bfcc7}

    /* Consistent clickable item sizing for thumbnails (vertical & horizontal) */
    .thumb{ height:80px; overflow:hidden; }
    .thumb img{ width:64px; height:64px; flex:0 0 64px; }
    .thumb .name, .thumb .meta, .thumb .badge{
      line-height:1.15;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width:160px;
    }

    /* Main */
    .main{position:relative;flex:1;display:flex;flex-direction:column}
    .topbar{display:block; border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.02),transparent)}
    @media(min-width:768px){.topbar.mobile{display:none}}

    .profilebar{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;border-bottom:1px solid var(--border);background:#0f1012a0;backdrop-filter:blur(8px)}
    .label{color:var(--muted);text-transform:uppercase;font-size:12px}
    .openbtn{border:1px solid var(--border);padding:8px 10px;border-radius:12px;background:transparent;color:var(--text)}
    .openbtn:hover{background:rgba(255,255,255,.06)}

    /* Compact prev/next buttons in the title bar (safe for touch/pinch) */
    .profile-actions{ display:flex; align-items:center; gap:8px; }
    .profile-btn{
      width:36px; height:36px;
      display:inline-flex; align-items:center; justify-content:center;
      border:1px solid var(--border); border-radius:10px;
      background:#0f1012b3; color:var(--text);
      cursor:pointer; outline:none;
    }
    .profile-btn:hover{ background:#0f1012cc; }
    .profile-btn svg{ width:22px; height:22px; }
    @media (max-width: 359px){
      .profile-btn{ width:32px; height:32px; }
      .profile-btn svg{ width:18px; height:18px; }
    }

    /* Bottom arrow controls inside the main viewfinder (non-blocking for pinch/zoom) */
    .view-actions{
      position:absolute;
      left:0; right:0;
      display:flex; align-items:center; justify-content:center; gap:10px;
      pointer-events:auto;
      z-index:20; /* above image/iframe (z=10), below top bars */
      bottom:8px; /* desktop / when no bottom rail */
    }
    @media (max-width: 767px){
      .view-actions{ bottom:72px; } /* clear the mobile thumbnail rail */
    }

    .viewport{position:absolute;inset:64px 0 0 0}
    @media(min-width:768px){.viewport{inset:68px 0 0 0}}
    .viewport iframe,.viewport img{width:100%;height:100%;display:block;position:relative;z-index:10}
    .viewport img{object-fit:contain;background:black}

    /* Touch: allow vertical panning inside content */

    /* Bottom rail (mobile) */
    .bottomrail{border-top:1px solid var(--border);background:#0f1012a6;backdrop-filter:blur(8px);position:relative;z-index:60}
    @media(min-width:768px){.bottomrail{display:none}}

    /* Welcome panel */
    .welcome{position:absolute;inset:0;display:grid;place-items:center;padding:24px}
    .wel-card{max-width:900px;width:min(100%,900px);border:1px solid var(--border);border-radius:24px;background:linear-gradient(135deg,rgba(16,185,129,.18),rgba(20,184,166,.08));padding:28px;box-shadow:var(--shadow)}
    .wel-card h2{margin:0 0 8px;font-size:22px}
    .wel-card p{margin:0 0 14px;color:#e5e7eb}
    .wel-grid{display:grid;grid-template-columns:1fr;gap:10px}
    .wel-item{padding:10px 12px;border-radius:14px;background:#0b0c0f80;border:1px solid var(--border)}
    @media(min-width:640px){.wel-grid{grid-template-columns:repeat(3,1fr)}}
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar (desktop) -->
    <aside class="sidebar" id="sidebar">
      <div class="header">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div class="title">Kingdom Rescue</div>
            <div class="subtitle">Scan → Browse → Tap profile</div>
          </div>
        </div>
      </div>
      <div class="search">
        <input id="search" placeholder="Search name, species, age…" />
        <div id="searchList" class="search-list hidden"></div>
      </div>
      <div id="thumbsVertical" class="thumbs-vertical no-scrollbar"></div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <!-- Top (mobile) header + search -->
      <div class="topbar mobile">
        <div class="header">
          <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
              <div class="title">Kingdom Rescue</div>
              <div class="subtitle">Scan → Browse → Tap profile</div>
            </div>
          </div>
        </div>
        <div class="search">
          <input id="searchM" placeholder="Search name, species, age…" />
          <div id="searchListM" class="search-list hidden"></div>
        </div>
      </div>

      <!-- Profile title bar -->
      <div class="profilebar">
        <div>
          <div class="label">Profile</div>
          <div id="profileTitle" style="font-weight:700"></div>
          <div id="profileMeta" class="subtitle" style="margin-top:2px"></div>
        </div>
        <div class="profile-actions">
          <button id="btnPrev" class="profile-btn" aria-label="Previous profile" title="Previous (←)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button id="btnNext" class="profile-btn" aria-label="Next profile" title="Next (→)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
          <a id="openExternal" class="openbtn" target="_blank" rel="noreferrer">Open in new tab</a>
        </div>
      </div>

      <!-- Viewport -->
      <div class="viewport" id="viewport"><!-- dynamic content injected here --></div>

      <!-- Bottom arrow navigation -->
      <div class="view-actions">
        <button id="viewPrev" class="profile-btn" aria-label="Previous profile" title="Previous (←)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <button id="viewNext" class="profile-btn" aria-label="Next profile" title="Next (→)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>

      <!-- Bottom thumbnails (mobile) -->
      <div class="bottomrail">
        <div id="thumbsHorizontal" class="thumbs-horizontal no-scrollbar"></div>
      </div>
    </main>
  </div>

  <script>
    // —— Data ——
    const ANIMALS = [
      { id: 'welcome', name: 'Welcome', species: '', thumb: 'thumbs/welcome_thumb.jpg', profileUrl: 'profiles/welcome_full.png' },
      { id: 'buckwheat', name: 'Buckwheat', species: 'Male • 4 months', thumb: 'thumbs/buckwheat_thumb.jpg', profileUrl: 'profiles/Buckwheat.png' },
      { id: 'porky', name: 'Porky', species: 'Male • 4 months', thumb: 'thumbs/porky_thumb.jpg', profileUrl: 'profiles/Porky.png' }
    ];

    // —— State helpers ——
    const qs = new URL(location.href);
    let activeId = qs.searchParams.get('id') || ANIMALS[0].id;

    // Navigation helpers (for arrows, keys, swipes)
    const order = () => ANIMALS.map(a=>a.id);
    function goPrev(){ const o=order(); const i=o.indexOf(activeId); setActive(o[(i-1+o.length)%o.length]); }
    function goNext(){ const o=order(); const i=o.indexOf(activeId); setActive(o[(i+1)%o.length]); }

    function setActive(id){
      activeId = id;
      const u = new URL(location.href);
      u.searchParams.set('id', id);
      history.replaceState({}, '', u);
      render();
      document.querySelectorAll('.thumb').forEach(el=>{
        el.classList.toggle('active', el.dataset.id===id);
      });
    }

    function isPdf(url){return (url||'').toLowerCase().endsWith('.pdf');}

    // —— Rendering ——
    function render(){
      const active = ANIMALS.find(a=>a.id===activeId) || ANIMALS[0];
      const title = document.getElementById('profileTitle');
      const meta = document.getElementById('profileMeta');
      const open = document.getElementById('openExternal');
      const vp = document.getElementById('viewport');

      if(!active || (active.id==='welcome' && !active.profileUrl)){
        title.textContent = 'Welcome';
        meta.textContent = 'How it works';
        open.href = '#';
        open.style.pointerEvents='none';
        open.style.opacity='.6';
        vp.innerHTML = `
          <div class="welcome">
            <div class="wel-card">
              <h2>Welcome to the Kingdom Rescue Foster Portal</h2>
              <p>Browse the animals below. Tap any profile to view their one-page info sheet. Ask a volunteer if you have questions or want to apply to foster.</p>
              <div class="wel-grid">
                <div class="wel-item">1. Scroll the thumbnail rail and tap a pet.</div>
                <div class="wel-item">2. The profile opens here. Pinch-zoom images or use the <em>Open in new tab</em> button for PDFs.</div>
                <div class="wel-item">3. Use the thumbnails to navigate, or arrow keys on desktop.</div>
              </div>
            </div>
          </div>`;
        return;
      }

      title.textContent = active.name;
      meta.textContent = active.species || '';
      open.href = active.profileUrl;
      open.style.pointerEvents='auto';
      open.style.opacity='1';

      if(isPdf(active.profileUrl)){
        vp.innerHTML = `<iframe title="${active.name} profile" src="${active.profileUrl}" loading="lazy"></iframe>`;
      } else {
        vp.innerHTML = `<img alt="${active.name} profile" src="${active.profileUrl}" loading="lazy">`;
      }
    }

    // —— Build thumbs once ——
    function thumbNode(a){
      const btn = document.createElement('button');
      btn.className = 'thumb';
      btn.dataset.id = a.id;
      btn.addEventListener('click',()=>setActive(a.id));
      btn.innerHTML = `
        <img src="${a.thumb}" alt="${a.name}">
        <div>
          <div class="name">${a.name}</div>
          ${a.species?`<div class="meta">${a.species}</div>`:''}
          ${a.id==='welcome'?'<div class="badge">Start here</div>':''}
        </div>`;
      return btn;
    }

    function buildThumbs(){
      const v = document.getElementById('thumbsVertical');
      const h = document.getElementById('thumbsHorizontal');
      v.innerHTML = ''; h.innerHTML='';
      ANIMALS.forEach(a=>{
        const nodeV = thumbNode(a); const nodeH = thumbNode(a);
        if(a.id===activeId){nodeV.classList.add('active');nodeH.classList.add('active');}
        v.appendChild(nodeV); h.appendChild(nodeH);
      });
    }

    // —— Search (desktop + mobile) ——
    function attachSearch(inputId,listId){
      const input = document.getElementById(inputId);
      const list = document.getElementById(listId);
      input.addEventListener('input',()=>{
        const s = input.value.trim().toLowerCase();
        if(!s){list.classList.add('hidden'); list.innerHTML=''; return;}
        const res = ANIMALS.filter(a=>a.id!=='welcome' && ((a.name||'').toLowerCase().includes(s) || (a.species||'').toLowerCase().includes(s))).slice(0,8);
        list.innerHTML = res.length? res.map(r=>`<button class="search-item" data-id="${r.id}"><strong>${r.name}</strong><small>${r.species||''}</small></button>`).join('') : `<div class="search-item" disabled>No matches.</div>`;
        list.classList.remove('hidden');
      });
      list.addEventListener('click',(e)=>{
        const b = e.target.closest('[data-id]');
        if(!b) return; setActive(b.dataset.id); list.classList.add('hidden'); input.value='';
      });
      document.addEventListener('click',(e)=>{ if(!list.contains(e.target) && e.target!==input) list.classList.add('hidden'); });
    }

    // —— Keyboard navigation ——
    function attachKeys(){
      window.addEventListener('keydown',(e)=>{
        if(['ArrowLeft','ArrowUp','a','w'].includes(e.key)) goPrev();
        if(['ArrowRight','ArrowDown','d','s'].includes(e.key)) goNext();
      });
    }


    // Init
    buildThumbs();
    attachSearch('search','searchList');
    attachSearch('searchM','searchListM');
    attachKeys();

    // Top-bar arrow buttons (do not interfere with pinch/zoom)
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    if (btnPrev && btnNext){
      btnPrev.addEventListener('click', goPrev);
      btnNext.addEventListener('click', goNext);
      // Keyboard accessibility when focused
      [btnPrev, btnNext].forEach(btn=>{
        btn.addEventListener('keydown',(e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); btn===btnPrev?goPrev():goNext(); }});
      });
    }

    // Bottom viewfinder arrows
    const viewPrev = document.getElementById('viewPrev');
    const viewNext = document.getElementById('viewNext');
    if (viewPrev && viewNext){
      viewPrev.addEventListener('click', goPrev);
      viewNext.addEventListener('click', goNext);
      // Keyboard accessibility when focused
      [viewPrev, viewNext].forEach(btn=>{
        btn.addEventListener('keydown',(e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); btn===viewPrev?goPrev():goNext(); }});
      });
    }

    render();
  </script>
</body>
</html>
